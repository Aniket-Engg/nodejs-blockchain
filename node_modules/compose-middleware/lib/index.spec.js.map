{"version":3,"file":"index.spec.js","sourceRoot":"","sources":["../src/index.spec.ts"],"names":[],"mappings":"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","sourcesContent":["import { compose, Middleware, Callback } from './index'\nimport { expect } from 'chai'\n\ndescribe('compose middleware', () => {\n  it('should compose middleware', (done) => {\n    const middleware = compose([\n      function (req: any, res: any, next: Callback) {\n        req.one = true\n        next()\n      },\n      function (req: any, res: any, next: Callback) {\n        req.two = true\n        next()\n      }\n    ])\n\n    const req: any = {}\n    const res: any = {}\n\n    middleware(req, res, function (err) {\n      expect(err).to.not.exist\n      expect(req.one).to.be.true\n      expect(req.two).to.be.true\n\n      return done()\n    })\n  })\n\n  it('should exit with an error', (done) => {\n    const middleware = compose([\n      function (req: any, res: any, next: Callback) {\n        req.one = true\n        next(new Error('test'))\n      },\n      function (req: any, res: any, next: Callback) {\n        req.two = true\n        next()\n      }\n    ])\n\n    const req: any = {}\n    const res: any = {}\n\n    middleware(req, res, function (err) {\n      expect(err).to.exist\n      expect(req.one).to.be.true\n      expect(req.two).to.not.exist\n\n      return done()\n    })\n  })\n\n  it('should short-cut handler with a single function', (done) => {\n    const middleware = compose([\n      function (req: any, res: any, next: Callback) {\n        req.one = true\n        next()\n      }\n    ])\n\n    const req: any = {}\n    const res: any = {}\n\n    middleware(req, res, function (err) {\n      expect(err).to.not.exist\n      expect(req.one).to.be.true\n\n      return done()\n    })\n  })\n\n  it('should accept a single function', (done) => {\n    const middleware = compose(function (req: any, res: any, next: Callback) {\n      req.one = true\n      next()\n    })\n\n    const req: any = {}\n\n    middleware(req, {}, function (err: Error) {\n      expect(err).to.not.exist\n      expect(req.one).to.be.true\n\n      return done()\n    })\n  })\n\n  it('should noop with no middleware', (done) => {\n    const middleware = compose([] as Middleware[])\n\n    middleware({}, {}, done)\n  })\n\n  it('should validate all handlers are functions', () => {\n    expect(() => compose(['foo'] as any)).to.throw(TypeError, 'Handlers must be a function')\n  })\n\n  it('should support error handlers', (done) => {\n    const middleware = compose(\n      function (req: any, res: any, next: Callback) {\n        return next(new Error('test'))\n      },\n      function (err: Error, req: any, res: any, next: Callback) {\n        return next()\n      },\n      function (req: any, res: any, next: Callback) {\n        req.success = true\n        return next()\n      },\n      function (err: Error, req: any, res: any, next: Callback) {\n        req.fail = true\n        return next()\n      }\n    )\n\n    const req: any = {}\n\n    middleware(req, {}, function (err) {\n      expect(req.fail).to.not.exist\n      expect(req.success).to.be.true\n\n      return done(err)\n    })\n  })\n\n  it('should error when calling `next()` multiple times', (done) => {\n    const middleware = compose(\n      function (req: any, res: any, next: Callback) {\n        next()\n\n        try {\n          next()\n        } catch (err) {\n          return done()\n        }\n      }\n    )\n\n    middleware({}, {}, function () {/* */})\n  })\n\n  it('should forward thrown errors', (done) => {\n    const middleware = compose(\n      function (req: any, res: any, next: Callback) {\n        throw new Error('Boom!')\n      }\n    )\n\n    middleware({}, {}, function (err) {\n      expect(err).to.exist\n      expect(err.message).to.equal('Boom!')\n\n      return done()\n    })\n  })\n})\n"]}